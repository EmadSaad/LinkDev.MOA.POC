<app-breadcrumb [CurrnetComponentName]="'PartialBuildingRequest'"></app-breadcrumb>


<div class="form-wrapper mb-0">

  <div class="row">

    <div class="col-lg-3 mb-0">

      <div class="h-100">

        <app-side-stages 
          [activeFirstLevel]="ActiveLevelOne" 
          [activeSecondLevel]="ActiveLevelTwo"
          [structure]="formStructure" 
          (onChange)="onSelect($event)"> 
        </app-side-stages>

      </div>


    </div>

    <div class="col-lg-9">

      <h1 class="page-title">
        {{'PartialBuildingRequest.PartialBuildingCompletionRequestName' | translate}}
      </h1>

      <!--Request-Header-->
      <app-app-header 
        [appHeader]="Application.ApplicationHeader" 
        class="mt-2">
      </app-app-header>

       <!-- Start Stage 1 -->

       <div [hidden]="ActiveLevelOne !== 1">

        <!--Validation-Message-->
        <div class="alert alert-light" role="alert" *ngIf="!PartialBuildingRequestId">
          <i class="icon-info"></i>
          {{'FORM_VALIDATION_MESSAGE' | translate}}
        </div>

        <app-request-submission-info 
            [submissionAlertClass]="this.submissionAlertClass"
            [submissionInfo]="this.submissionInfo">
        </app-request-submission-info>

        <form #stageOne="ngForm" novalidate autocomplete="off">

          <div class="row">

            <div class="col-lg-4 col-md-6">

              <mutliselect 
                  id="CRId"
                  name="CRId"
                  [label]="'PartialBuildingRequest.CR'"
                  [propertyToSelect]="'Value'"
                  [options]="lookupService.lookupEntities['account_CRsByTypeInvestor']"
                  [viewMode]="Application.Request.IsSubmitted"
                  [multiple]="false"
                  [config]="config"
                  [(ngModel)]="Application.Request.CRId"
                  [required]="true"
                  [disabled]="false"
                  [isRequiredLabel]="true"
                  (change)="cRChanged()"
                  #CRId="ngModel">
                </mutliselect>

                <app-validation-viewer 
                [requiredValidations]="{'required':'Validations.Required'}" 
                [controlName]="CRId"
                [form]="stageOne" 
                [submit]="Application.IsSubmitted"> 
               </app-validation-viewer>


            </div>

            <app-info-viewer 
                [isLoading]="isCurrentCR" 
                [modalFormTitleKey]="'PartialBuildingRequest.CRInfo'" 
                name="CRInfo"
                *ngIf="Application.Request.CRId">

                <div class="row">

                  <div class="col-lg-4 col-md-6">

                    <custom-text-box 
                      [type]="'text'" 
                      name="CurrentCRType" 
                      #CurrentCRType="ngModel"
                      [(ngModel)]="CurrentCR.CRType" 
                      [label]="'ContractSubmission.Type'" 
                      autocomplete=""
                      aria-label="Name" 
                      [isReadOnly]="true"> 
                    </custom-text-box>

                  </div>

                  <div class="col-lg-4 col-md-6">

                    <custom-text-box 
                      [type]="'text'" 
                      name="CurrentCRNumber" 
                      #CurrentCRNumber="ngModel"
                      [(ngModel)]="CurrentCR.CRNumber" 
                      [label]="'ContractSubmission.CRNumber'" 
                      autocomplete=""
                      aria-label="Name" 
                      [isReadOnly]="true">
                    </custom-text-box>

                  </div>

                  <div class="col-lg-4 col-md-6">

                    <label>
                      {{'ContractSubmission.CRIssuanceDate' | translate}}
                    </label>

                    <ngbd-datepicker-popup 
                      [(ngModel)]="CurrentCR.IssueDate" 
                      name="IssueDate" 
                      [readonly]="true">
                    </ngbd-datepicker-popup>

                  </div>

                  <div class="col-lg-4 col-md-6">

                    <label>
                      {{'ContractSubmission.CRExpiryDate' | translate}}
                    </label>

                    <ngbd-datepicker-popup 
                      [(ngModel)]="CurrentCR.ExpiryDate" 
                      name="ExpiryDate"
                      [ngModelOptions]="{standalone: true}"
                      [readonly]="true">
                    </ngbd-datepicker-popup>

                  </div>

                  <div class="col-lg-4 col-md-6">

                    <custom-text-box 
                      [type]="'text'" 
                      name="CurrentCRName" 
                      #CurrentCRName="ngModel"
                      [(ngModel)]="CurrentCR.CRName" 
                      [label]="'ContractSubmission.Name'" 
                      autocomplete=""
                      aria-label="Name" 
                      [isReadOnly]="true"> 
                    </custom-text-box>

                  </div>

                  <div class="col-lg-8 col-md-6">

                    <label>
                      {{'ContractSubmission.Activity' | translate}}
                    </label>

                    <textarea 
                      id="CurrentCRActivity" 
                      name="CurrentCRActivity" 
                      [readOnly]="true"
                      #CurrentCRActivity="ngModel" 
                      [(ngModel)]="CurrentCR.CRActivity" 
                      disabled>
                    </textarea>

                  </div>

                </div>

                <app-grid 
                  [canAdd]="false" 
                  [canDelete]="false" 
                  [canEdit]="false"
                  [tableHeadTitle]="'ContractSubmission.Owners'" 
                  [(data)]="CurrentCR.CROwners"
                  [columns]="CROwnerGridcols"> 
                </app-grid>

              </app-info-viewer>

          </div>


          <div class="row">

            <div class="col-lg-4 col-md-6" >

              <mutliselect 
                  id="ContractNumber"
                  name="ContractNumber"
                  [label]="'PartialBuildingRequest.ContractNumber'"
                  [propertyToSelect]="'Value'"
                  [options]="lookupService.lookupEntities['ldv_contract_LookupWithId']"
                  [multiple]="false"
                  [config]="config"
                  [viewMode]="isContractNumberReadOnly"
                  [(ngModel)]="Application.Request.ContractNumberId"
                  [required]="true"
                  [disabled]="false"
                  [isRequiredLabel]="true"
                  #ContractNumber="ngModel"
                  (change)="contractChanged()">
                </mutliselect>

                <app-validation-viewer 
                  [requiredValidations]="{'required':'Validations.Required'}"
                  [controlName]="ContractNumber" 
                  [form]="stageOne" 
                  [submit]="Application.IsSubmitted">
                </app-validation-viewer>

            </div>

            <app-info-viewer 
            [isLoading]="isCurrentContract" 
            [modalFormTitleKey]="'PartialBuildingRequest.ContractInfo'"
            name="ContactInfo" 
            *ngIf="Application.Request.ContractNumberId&&CurrentContract">

            <div class="row">

              <div class="col-lg-4 col-md-6" *ngIf="CurrentContract.CR">

                <custom-text-box 
                  [type]="'text'" 
                  name="CRContract" 
                  #CRContract="ngModel"
                  [(ngModel)]="CurrentContract.CR.Name" 
                  [label]="'ContractSubmission.CRId'" 
                  autocomplete=""
                  aria-label="Name" 
                  [isReadOnly]="true"> 
                </custom-text-box>

              </div>

              <div class="col-lg-4 col-md-6" *ngIf="CurrentContract.Industrialcity">

                <custom-text-box 
                  [type]="'text'" 
                  name="ContractIndustrialCity" 
                  #ContractIndustrialCity="ngModel"
                  [(ngModel)]="CurrentContract.Industrialcity.Name" 
                  [label]="'ContractSubmission.IndustrialCity'"
                  autocomplete="" 
                  aria-label="Name" 
                  [isReadOnly]="true">
                </custom-text-box>

              </div>

              <div class="col-lg-4 col-md-6" *ngIf="CurrentContract.ProductMainfamily">

                <custom-text-box 
                  [type]="'text'" 
                  name="ContractProductMainFamily"
                  #ContractProductMainFamily="ngModel" 
                  [(ngModel)]="CurrentContract.ProductMainfamily.Name"
                  [label]="'ContractSubmission.ProductMainFamily'" 
                  autocomplete="" 
                  aria-label="Name"
                  [isReadOnly]="true">
                </custom-text-box>

              </div>

              <div class="col-lg-4 col-md-6" *ngIf="CurrentContract.ProductSubFamily">

                <custom-text-box 
                  [type]="'text'" 
                  name="ContractProductSubFamily"
                  #ContractProductMainFamily="ngModel" 
                  [(ngModel)]="CurrentContract.ProductSubFamily.Name"
                  [label]="'ContractSubmission.ProductSubFamily'" 
                  autocomplete="" 
                  aria-label="Name"
                  [isReadOnly]="true">
                </custom-text-box>

              </div>

              <div class="col-lg-4 col-md-6" *ngIf="CurrentContract.Product">

                <custom-text-box 
                  [type]="'text'" 
                  name="ContractProduct" 
                  #ContractProduct="ngModel"
                  [(ngModel)]="CurrentContract.Product.Name" 
                  [label]="'ContractSubmission.Product'" 
                  autocomplete=""
                  aria-label="Name" 
                  [isReadOnly]="true">
                </custom-text-box>

              </div>

              <div class="col-lg-4 col-md-6">

                <custom-text-box 
                  [type]="'text'" 
                  name="ContractConstructionAmountValue"
                  #ContractConstructionAmountValue="ngModel"
                  [(ngModel)]="CurrentContract.ConstructionContractStatus"
                  [label]="'ContractSubmission.ConstructionAmountValue'" 
                  autocomplete="" 
                  aria-label="Name"
                  [isReadOnly]="true">
                </custom-text-box>

                

              </div>

              <div class="col-lg-4 col-md-6">

                <custom-text-box 
                  [type]="'text'" 
                  name="ContractLegalStatus" 
                  #ContractLegalStatus="ngModel"
                  [(ngModel)]="CurrentContract.LegalStatus" 
                  [label]="'PartialBuildingRequest.LegalStatus'"
                  autocomplete="" 
                  aria-label="Name" 
                  [isReadOnly]="true">
                </custom-text-box>

              </div>

              <div class="col-lg-4 col-md-6">

                <custom-text-box 
                  [type]="'text'" 
                  name="ContractPricingdate" 
                  #ContractPricingdate="ngModel"
                  [(ngModel)]="CurrentContract.Pricingdate" 
                  [label]="'PartialBuildingRequest.Pricingdate'"
                  autocomplete="" 
                  aria-label="Name" 
                  [isReadOnly]="true">
                </custom-text-box>

              </div>

              <div class="col-lg-4 col-md-6">

                <custom-text-box 
                  [type]="'text'" 
                  name="ContractFileNumber" 
                  #ContractFileNumber="ngModel"
                  [(ngModel)]="CurrentContract.FileNumber" 
                  [label]="'PartialBuildingRequest.FileNumber'"
                  autocomplete="" 
                  aria-label="Name" 
                  [isReadOnly]="true">
                </custom-text-box>

              </div>

              <div class="col-lg-4 col-md-6">

               

                <label>
                  {{'PartialBuildingRequest.ContractStartingDate' | translate}}
                </label>

                <ngbd-datepicker-popup 
                  [(ngModel)]="CurrentContract.ContractStartingDate" 
                  [readonly]="true"
                  name="ContractStartingDate">
                </ngbd-datepicker-popup>

              </div>

              <div class="col-lg-4 col-md-6">

                <!-- {{CurrentContract.ContractStartingDate | json}} -->
                <label>
                  {{'PartialBuildingRequest.ContractExpiryDate' | translate}}
                </label>

                <ngbd-datepicker-popup 
                  [(ngModel)]="CurrentContract.ContractExpiryDate" 
                  [readonly]="true"
                   name="ContractExpiryDate">
                  </ngbd-datepicker-popup>

              </div>

            </div>

            <app-grid 
              *ngIf="contactDetailsfromContract && contactDetailsfromContract.length > 0" 
              [canAdd]="false"
              [canDelete]="false" 
              [canEdit]="false" 
              [modalFormTitle]="'ContractContactsDetails'"
              [tableHeadTitle]="'PartialBuildingRequest.ContactDetails'" 
              [(data)]="contactDetailsfromContract"
              [columns]="gridcols" 
              [(model)]="gridModel" 
              [canAdd]="false" 
              [canEdit]="false" 
              [canDelete]="false">
            </app-grid>

          </app-info-viewer>

          </div>


          <div class="row">

            <div class="col-lg-4 col-md-6">

                <mutliselect 
                  id="BuildingLicense"
                  name="BuildingLicense"
                  [label]="'PartialBuildingRequest.BuildingLicense'"
                  [propertyToSelect]="'Value'"
                  [options]="lookupService.lookupEntities['ldv_buildinglicense_LookupWithId']"
                  [multiple]="false"
                  [config]="config"
                  [viewMode]="isBuildingLicenseReadOnly"
                  [(ngModel)]="Application.Request.BuildingLicenseId"
                  [required]="true"
                  [disabled]="false"
                  [isRequiredLabel]="true"
                  #BuildingLicense="ngModel"
                  (change)="buildingLicenseChanged()">
                </mutliselect>

                

                <app-validation-viewer 
                  [requiredValidations]="{'required':'Validations.Required'}"
                  [controlName]="BuildingLicense" 
                  [form]="stageOne" 
                  [submit]="Application.IsSubmitted">
                </app-validation-viewer>

               

                <div class="form-validation mb-4" *ngIf="!IsRequestValid">
                  {{requestValidMsg}}
                </div>

            </div>


          </div>

          <div class="row">

            <div class="col-lg-4 col-md-6">

              <mutliselect 
                id="Contacts" 
                name="Contacts" 
                [label]="'PartialBuildingRequest.Contacts'"
                [propertyToSelect]="'Value'"
                [options]="lookupService.lookupEntities['ldv_contactdetails_ContactDetails']"
                [viewMode]="Application.Request.IsSubmitted"
                [multiple]="true" 
                [config]="config"
                [(ngModel)]="Application.Request.Contacts" 
                [required]="false" 
                [disabled]="false"
                [isRequiredLabel]="false" 
                #Contacts="ngModel" 
                (change)="onContactChange($event)">
              </mutliselect>

            </div>

          </div>

          <!-- contact Details grid -->
          <app-grid 
            *ngIf="Application.Request.Contacts && Application.Request.Contacts.length>0 && lookupService.lookupEntities['ldv_contactdetails_ContactDetails']"
            [modalFormTitle]="'Biddings'" 
            [tableHeadTitle]="'PartialBuildingRequest.ContactDetails'"
            [(data)]="contactsList" 
            [columns]="gridcols" 
            [(model)]="gridModel" 
            [canAdd]="false" 
            [canEdit]="false"
            [canDelete]="false">
          </app-grid>

          <div class="col form-footer position-relative d-flex flex-column justify-content-center flex-md-row justify-content-md-between">

            <button 
                class="main-btn" 
                [disabled]="!IsRequestValid||Application.Request.IsSubmitted"
                (click)="Submit()">
                {{'ServicesCommon.Submit' | translate}}
              </button>

          </div>



        </form>

       </div>

       <!-- End Stage 1 -->


      <!-- Start Stage 2 | Certificate Details-->

      <div class="mt-4" [hidden]="ActiveLevelOne !== 2">

        <div class="row">

          <div class="col-lg-6 col-md-6"
               *ngIf="Application.Request.PartialBuildingCertificateId && PartialBuildingRequestId">

            <custom-text-box 
              [type]="'text'"
              [label]="'PartialBuildingRequest.PartialBuildingCompleteionCertificateNumber'"
              [(ngModel)]="Application.Request.PartialBuildingCertificate.Name" 
              #PartialBuildingCertificate="ngModel"
              name="PartialBuildingCertificate" 
              [isRequiredLabel]="false" 
              [isReadOnly]="true">
            </custom-text-box>

          </div>

        </div>
        <div class="row" *ngIf="Application.Documents&&Application.Documents[0].Files.length>0">
          
          <div class="col-lg-6 col-md-6">

            <app-Uploaders-List 
              [uploaders]="Application.Documents" 
              [SectionName]="'PBRCertificate'"
              [IsLiveChanges]="true" 
              [IsReadOnly]="true">
            </app-Uploaders-List>

          </div>

        </div>
        
      </div>

      <!-- End Stage 2 -->

    </div>

  </div>

</div>
